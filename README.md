# Pillo - 輪廓偵測系統
一個基於 OpenCV 和 React 的即時輪廓偵測系統，支援多種算法和跨設備訪問。

## 🚀 快速啟動

### 方法一：使用啟動腳本 (推薦)
```bash
# Windows 用戶
start.bat

# 或使用 PowerShell
.\start.ps1
```

### 方法二：手動啟動
```bash
# 1. 啟動後端
cd pillo_backend
pip install -r requirements.txt
python main.py
#要關防火牆
sudo /usr/libexec/ApplicationFirewall/socketfilterfw --setglobalstate off

# 2. 啟動前端 (另開終端)
cd pillo_frontend
pnpm install
pnpm run dev --host
```

## 📱 訪問地址

### 本機訪問
- 前端: http://localhost:5173
- 後端: http://localhost:8000

### 局域網訪問 (手機可連接)
- 前端: http://[您的IP地址]:5173
- 後端: http://[您的IP地址]:8000

### 手機使用
1. 確保手機和電腦在同一 WiFi 網路
2. 在手機瀏覽器中訪問 `http://192.168.0.5:5173` (使用您電腦的實際 IP)
3. 首次使用時允許攝影機權限
4. 選擇"自動選擇"或"強制使用手機攝影機"模式
5. 點擊"開始攝影"即可使用手機攝影機

詳細的手機使用指南請參考 [MOBILE_GUIDE.md](MOBILE_GUIDE.md)

## 🔧 故障排除

### 前端沒有畫面
1. **運行診斷工具**: 執行 `diagnose.bat` 檢查系統狀態
2. **檢查後端服務**: 確保後端在端口 8000 上運行
3. **檢查網路連接**: 確認前端能連接到後端 API
4. **查看瀏覽器控制台**: 按 F12 查看是否有 JavaScript 錯誤
5. **重新啟動服務**: 使用 `start.bat` 重新啟動前後端

### 攝影機無法連接
1. 確保攝影機沒有被其他應用程式使用
2. 檢查攝影機驅動是否正常
3. 嘗試重新插拔 USB 攝影機
4. 在 Windows 設定中檢查攝影機權限

### 手機無法連接
1. 確保手機和電腦在同一局域網
2. 檢查 Windows 防火牆設定
3. 確保端口 5173 和 8000 沒有被阻擋
4. 使用電腦的實際 IP 地址而非 localhost

### 後端攝影機錯誤
- 系統已改進錯誤處理，會自動嘗試不同的攝影機後端
- 如果持續出現錯誤，請重啟應用程式

### 手機攝影機使用說明
1. **首次使用**: 瀏覽器會請求攝影機權限，請點擊"允許"
2. **攝影機選擇**: 在攝影機模式中選擇"自動選擇"或"強制使用手機攝影機"
3. **權限問題**: 如果無法訪問攝影機，請檢查瀏覽器設定中的攝影機權限
4. **HTTPS 要求**: 某些瀏覽器需要 HTTPS 才能訪問攝影機

### 常見錯誤解決方案
- **"無法連接到後端服務"**: 檢查後端是否啟動，端口是否被佔用
- **"設備註冊失敗"**: 檢查網路連接和 API 端點
- **"攝影機啟動失敗"**: 檢查攝影機權限和驅動
- **"CORS 錯誤"**: 確認後端 CORS 設定正確
- **"無法訪問手機攝影機"**: 檢查瀏覽器攝影機權限，確保使用 HTTPS

## 🛠️ 技術架構
- 前端: React + Vite + Tailwind CSS
- 後端: FastAPI + OpenCV
- 支援算法: Otsu 二值化、Canny 邊緣偵測、YOLOv11

## 🔄 多設備支援

### 設備類型檢測
系統會自動檢測設備類型：
- **手機 (Mobile)**: 使用手機攝影機 (WebRTC)
- **平板 (Tablet)**: 使用平板攝影機 (WebRTC)  
- **電腦 (Desktop)**: 使用電腦攝影機 (OpenCV)

### 攝影機模式選擇
- **自動選擇**: 根據設備類型自動選擇攝影機
- **強制使用手機攝影機**: 即使在電腦上也使用手機攝影機
- **強制使用電腦攝影機**: 即使在手機上也使用電腦攝影機

### 手機攝影機功能
- 支援直接訪問手機的前置/後置攝影機
- 使用 WebRTC API 捕獲手機攝影機畫面
- 自動處理攝影機權限請求
- 支援實時畫面捕獲和處理

### 同時使用多設備
- 多個設備可以同時連接到系統
- 每個設備會自動註冊獨立的會話
- 系統會顯示當前活躍的設備數量
- 會話會在 5 分鐘無活動後自動清理

### 網路地址說明
- `localhost:5173` - 本機訪問
- `192.168.0.5:5173` - 局域網訪問 (主要網路)
- `192.168.56.1:5173` - 虛擬機網路
- `172.22.112.1:5173` - VPN 或其他網路

**為什麼只有 192.168.0.5 可以用？**
這是您電腦連接到路由器的主要 IP 地址，其他設備可以通過這個地址訪問您的電腦。